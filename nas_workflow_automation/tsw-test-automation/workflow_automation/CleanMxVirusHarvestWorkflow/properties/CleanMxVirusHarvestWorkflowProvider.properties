# Provider 
provider.classname=com.mcafee.tsw.agent.provider.HTTPFileWorkProvider
provider.source_url=https://support.clean-mx.com/clean-mx/xmlviruses.php?delta=<<<max_id>>>&sort=id%20asc
provider.userAgent="McAfee Automation (u2support@mcafee.com)"
provider.binaryMode=true
provider.targetDir=./CleanMxVirusHarvestWorkflow/download
provider.errorDir=./CleanMxVirusHarvestWorkflow/error
provider.archiveDir=./CleanMxVirusHarvestWorkflow/archive

FactTracker.id=max_id,last,com.mcafee.tsw.agent.facttracker.NextToLastFactTracker
FactTracker.fileStore=/data/webcache/workflows/harvesters/CleanMxVirusHarvestWorkflow/facts.txt


# To avoid certificate issues
downloadUrl.securityProviderClass=org.bouncycastle.jce.provider.BouncyCastleProvider
downloadUrl.allowAllCerts=true
downloadUrl.supportedSSLVersion=TLSv1


# Worker 1 Settings
worker.classname.1=com.mcafee.tsw.agent.worker.PreprocessorWorker
worker.threadcount.1=1
Preprocessor.count=1
Preprocessor.1.className=com.mcafee.tsw.preprocessor.RegexReplacePreprocessor
RegexReplacePreprocessor.match.1=\\017
RegexReplacePreprocessor.replace.1=%0FM

# Convert vt_score sting of "x/y (z.d%)" to "z", now it truncates instead of rounding.
RegexReplacePreprocessor.match.2=<vt_score>([0-9]+)/([0-9])+.*\\(([0-9]*).*?%\\).*</vt_score>
RegexReplacePreprocessor.replace.2=<vt_score>$3</vt_score><vt_hits>$1</vt_hits>

RegexReplacePreprocessor.match.3=</url>]]></url>
RegexReplacePreprocessor.replace.3=</url>

RegexReplacePreprocessor.match.4=</url>/]]></url>
RegexReplacePreprocessor.replace.4=</url>

RegexReplacePreprocessor.match.5=]]>]]></url>
RegexReplacePreprocessor.replace.5=]]></url>

# Convert missing vt_scores to 0
RegexReplacePreprocessor.match.6=<vt_score></vt_score>
RegexReplacePreprocessor.replace.6=<vt_score>0</vt_score>


# Worker 2 Settings
worker.classname.2=com.mcafee.tsw.agent.worker.FileParserWorker
worker.threadcount.2=1
# Parser Settings
parser.classname=com.mcafee.tsw.parser.XMLFileParser
XMLFileParser.prefix=XMLFileParser.xmltag
XMLFileParser.required=url,response
XMLFileParser.root=entry
XMLFileParser.key=url

XMLFileParser.xmltag.url=url
XMLFileParser.xmltag.line=line
XMLFileParser.xmltag.id=id
XMLFileParser.xmltag.first=first
XMLFileParser.xmltag.last=last
XMLFileParser.xmltag.md5=md5
XMLFileParser.xmltag.virustotal=virustotal
XMLFileParser.xmltag.vt_score=vt_score
XMLFileParser.xmltag.vt_hits=vt_hits
XMLFileParser.xmltag.scanner=scanner
XMLFileParser.xmltag.virusname=virusname
XMLFileParser.xmltag.recent=recent
XMLFileParser.xmltag.response=response
XMLFileParser.xmltag.ip=ip
XMLFileParser.xmltag.as=as
XMLFileParser.xmltag.review=review
XMLFileParser.xmltag.domain=domain
XMLFileParser.xmltag.country=country
XMLFileParser.xmltag.source=source
XMLFileParser.xmltag.email=email
XMLFileParser.xmltag.inetnum=inetnum
XMLFileParser.xmltag.netname=netname
XMLFileParser.xmltag.descr=descr
XMLFileParser.xmltag.ns1=ns1
XMLFileParser.xmltag.ns2=ns2
XMLFileParser.xmltag.ns3=ns3
XMLFileParser.xmltag.ns4=ns4
XMLFileParser.xmltag.ns5=ns5


# Consumer
consumer.classname=com.mcafee.tsw.agent.consumer.ActiveMQWorkflowConsumer
consumer.enableHeartbeat=true
consumer.heartrate=200

activemq_producer.connectionString=failover:(tcp://localhost:61616)
activemq_producer.username=admin
activemq_producer.password=admin
activemq_producer.queueName=cleanmxvirus_harvest_urls



# Info
verbose=true
agent.name=CleanMxVirusHarvestWorkflow
agent.getlock=false
